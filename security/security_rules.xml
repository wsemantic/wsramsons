<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Regla de registro mejorada --> 
    <record id="wsramsons_regla_acceso_comercial" model="ir.rule">
        <field name="name">[wsramsons] Contactos: Restricci贸n por comercial</field>
        <field name="model_id" ref="base.model_res_partner"/>
        <field name="domain_force">[('user_id', '=', user.id)]</field>
        <field name="groups" eval="[(4, ref('wsramsons.group_comercial'))]"/>
        <field name="perm_read" eval="True"/>
        <field name="perm_write" eval="True"/>
        <field name="perm_create" eval="True"/>
        <field name="perm_unlink" eval="False"/>
        <field name="global" eval="False"/>
        <!-- Asegurar que se cree el External ID -->
        <field name="active" eval="True"/>
    </record>

    <!-- Acceso a la informaci贸n del propio usuario -->
    <record id="wsramsons_user_self_rule" model="ir.rule">
        <field name="name">[wsramsons] Usuarios: Solo su propio registro</field>
        <field name="model_id" ref="base.model_res_users"/>
        <field name="domain_force">[('id', '=', user.id)]</field>
        <field name="groups" eval="[(4, ref('wsramsons.group_comercial'))]"/>
        <field name="perm_read" eval="True"/>
        <field name="perm_write" eval="False"/>
        <field name="perm_create" eval="False"/>
        <field name="perm_unlink" eval="False"/>
        <field name="global" eval="False"/>
        <field name="active" eval="True"/>
    </record>
	
	
	<record id="wsramsons_regla_acceso_comercial" model="ir.rule">
		<field name="name">[wsramsons] Contactos: Clientes propios; resto libres</field>
		<field name="model_id" ref="base.model_res_partner"/>
		<!-- Dominio:
			 - Siempre puede ver su propio partner (id = user.partner_id.id)
			 - CUALQUIER partner que NO sea cliente (customer_rank = 0) es visible (no restringimos)
			 - Si ES cliente (customer_rank > 0), entonces debe cumplir user_id = user.id
		-->
		<field name="domain_force">
			<![CDATA[
				['|',
				  ('id','=',user.partner_id.id),
				  '|',
					('customer_rank','=',0),
					'&', ('customer_rank','>',0), ('user_id','=',user.id)
				]
			]]>
		</field>
		<field name="groups" eval="[(4, ref('wsramsons.group_comercial'))]"/>
		<field name="perm_read" eval="True"/>
		<field name="perm_write" eval="True"/>
		<field name="perm_create" eval="True"/>
		<field name="perm_unlink" eval="False"/>
		<field name="global" eval="False"/>
		<field name="active" eval="True"/>
	</record>


    <!-- Facturas visibles solo para el comercial asignado al cliente 
    <record id="wsramsons_invoice_salesman_rule" model="ir.rule">
        <field name="name">[wsramsons] Facturas: Restricci贸n por comercial</field>
        <field name="model_id" ref="account.model_account_move"/>
        <field name="domain_force">[('partner_id.user_id', '=', user.id)]</field>
        <field name="groups" eval="[(4, ref('wsramsons.group_comercial'))]"/>
        <field name="perm_read" eval="True"/>
        <field name="perm_write" eval="False"/>
        <field name="perm_create" eval="False"/>
        <field name="perm_unlink" eval="False"/>
        <field name="global" eval="False"/>
        <field name="active" eval="True"/>
    </record>
	
	<record id="wsramsons_invoice_commercial_rule" model="ir.rule">
		<field name="name">[wsramsons] Pedidos: Restricci贸n por comercial</field>
		<field name="model_id" ref="sale.model_sale_order"/>
		<field name="domain_force">
			['|', ('user_id', '=', user.id),
				 ('partner_id.user_id', '=', user.id)]
		</field>
		<field name="groups" eval="[(4, ref('wsramsons.group_comercial'))]"/>
	</record> 
  -->
</odoo>
